<?php
/**
 * Performs a search on the database
 * 
 * @package		Search
 * @author		Michaël V. Dandrieux <mvd@cafecentral.fr>
 * @access		public
 * @link		http://www.cafecentral.fr/fr/wiki
 */
class search
{
	public $string;
	public $env;
	
	/**
	 * Bon
	 *
	 * @access	public
	 */
	public function __construct($string, $env)
	{
		$this->string = $string;
		$this->env = $env;
	}
	
	/**
	 * Voilà quoi
	 *
	 * @access	public
	 */
	public function results()
	{	
	//	Get the list of structures
		$structures = cc('structure', all, $this->env);

	//	Loop through structures in search for text fields
		foreach ($structures as $structure)
		{
			foreach ($structure['attr'] as $key => $attr)
			{
				if ($attr['key'] == 'title') $table[] = $structure['key'];
			}
		}

	//	Loop through the table search
		$p = array('title' => '%'.$this->string.'%');
		foreach ($table as $table) {
			$result = cc($table, $p, $this->env);
			if ($result->count() >0 ) $return[] = $result;
		}

	//	Return
		if (isset($return)) return $return;
	}
}
?>